<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/app.css">
</head>
<body class="viewer">

<div class="video-wrap">
  <video id="video" playsinline autoplay></video>
</div>

<div class="info">
  <h2 id="title">Loading...</h2>
  <p id="episode">Episode 1</p>

  <div class="actions">
    <button onclick="next()">â–¶ Next Episode</button>
    <button class="lock">ðŸ”’ Unlock</button>
  </div>
</div>

<script>
const bookId = new URLSearchParams(location.search).get("bookId")
let chapter = 0

const video = document.getElementById("video")
const epText = document.getElementById("episode")

function load() {
  fetch("/api/watch", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ bookId, chapterIndex: chapter, lang: "in" })
  })
  .then(r => r.json())
  .then(d => {
    video.src = d.data.playUrl
    epText.innerText = "Episode " + (chapter + 1)
  })
}

function next() {
  chapter++
  load()
}

load()
</script>

</body>
</html>
